<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:3,&quot;tests&quot;:5,&quot;passes&quot;:4,&quot;pending&quot;:0,&quot;failures&quot;:1,&quot;start&quot;:&quot;2025-12-19T16:56:40.545Z&quot;,&quot;end&quot;:&quot;2025-12-19T16:57:26.201Z&quot;,&quot;duration&quot;:45656,&quot;testsRegistered&quot;:5,&quot;passPercent&quot;:80,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;51fea4ee-6105-4a47-b958-11949121b632&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;cypress\\e2e\\Challenging-DOM.cy.js&quot;,&quot;file&quot;:&quot;cypress\\e2e\\Challenging-DOM.cy.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;38f90bf6-fe46-49d5-866c-bf4ab9be31dc&quot;,&quot;title&quot;:&quot;BT8&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Lấy danh sách các giá trị trong bảng&quot;,&quot;fullTitle&quot;:&quot;BT8 Lấy danh sách các giá trị trong bảng&quot;,&quot;duration&quot;:2948,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;cy.visit(\&quot;https://practice.expandtesting.com/challenging-dom\&quot;);\n// 1) Lấy danh sách header\ncy.get(\&quot;table thead th\&quot;).then($ths =&gt; {\n  const headers = [...$ths].map(th =&gt; th.innerText.trim());\n  // headers: [\&quot;Lorem\&quot;,\&quot;Ipsum\&quot;,\&quot;Dolor\&quot;,\&quot;Sit\&quot;,\&quot;Amet\&quot;,\&quot;Diceret\&quot;,\&quot;Action\&quot;]\n  // 2) Duyệt từng row và build array object\n  cy.get(\&quot;table tbody tr\&quot;).then($rows =&gt; {\n    const data = [...$rows].map(row =&gt; {\n      const cells = [...row.querySelectorAll(\&quot;td\&quot;)].map(td =&gt; td.innerText.trim());\n      // Map header -&gt; cell thành object\n      const obj = headers.reduce((acc, h, idx) =&gt; {\n        var _cells$idx;\n        acc[h] = (_cells$idx = cells[idx]) !== null &amp;&amp; _cells$idx !== void 0 ? _cells$idx : \&quot;\&quot;;\n        return acc;\n      }, {});\n      return obj;\n    });\n    // 3) Wrap để dùng tiếp trong Cypress chain\n    cy.wrap(data, {\n      log: false\n    }).as(\&quot;tableData\&quot;);\n  });\n});\n// Ví dụ dùng tiếp: in ra / assert\ncy.get(\&quot;@tableData\&quot;).then(tableData =&gt; {\n  cy.log(JSON.stringify(tableData, null, 2));\n  expect(tableData).to.have.length.greaterThan(0);\n  expect(tableData[0]).to.have.all.keys(\&quot;Lorem\&quot;, \&quot;Ipsum\&quot;, \&quot;Dolor\&quot;, \&quot;Sit\&quot;, \&quot;Amet\&quot;, \&quot;Diceret\&quot;, \&quot;Action\&quot;);\n  /* Đoạn này mình dùng để ghi lại kết quả, sau khi chạy thì tạo thành file data lưu cypress/fixtures/tableData.json */\n  //       cy.get(\&quot;@tableData\&quot;).then((tableData) =&gt; {\n  //   cy.writeFile(\&quot;cypress/fixtures/tableData.json\&quot;, tableData);\n  // });\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;36a34e7b-c713-4631-89cf-b76be5be9041&quot;,&quot;parentUUID&quot;:&quot;38f90bf6-fe46-49d5-866c-bf4ab9be31dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;36a34e7b-c713-4631-89cf-b76be5be9041&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2948,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9db434dc-6247-4592-aa8a-3392bab2a77d&quot;,&quot;title&quot;:&quot;BT9&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Click yellow 10 times, wait redirect each time&quot;,&quot;fullTitle&quot;:&quot;BT9 Click yellow 10 times, wait redirect each time&quot;,&quot;duration&quot;:15315,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;Cypress._.times(10, () =&gt; {\n  yellowBtn().should(\&quot;be.visible\&quot;).click();\n  // chờ trang reload xong (redirect/reload)\n  cy.wait(\&quot;@reloadPage\&quot;);\n  // xác nhận trang đã load lại (không dùng equal)\n  cy.get(\&quot;h1\&quot;).should(\&quot;contain\&quot;, \&quot;Challenging DOM\&quot;);\n  cy.url().should(\&quot;include\&quot;, \&quot;/challenging-dom\&quot;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff6e1622-bcb3-4338-bf98-69df254e5880&quot;,&quot;parentUUID&quot;:&quot;9db434dc-6247-4592-aa8a-3392bab2a77d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ff6e1622-bcb3-4338-bf98-69df254e5880&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15315,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;38acbb1c-6380-4c46-b3ea-a2c2e6d7b77d&quot;,&quot;title&quot;:&quot;BT10&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Cách 1- Lấy dataURL từ canvas rồi OCR canvas (OCR)&quot;,&quot;fullTitle&quot;:&quot;BT10 Cách 1- Lấy dataURL từ canvas rồi OCR canvas (OCR)&quot;,&quot;duration&quot;:1836,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;/*Chụp canvas =&gt; OCR bằng tesseract.js (đọc được mọi chữ vẽ) \n * Biến nội dung được vẽ trên thẻ &lt;canvas&gt; thành một ảnh (dạng dataURL),\n *  sau đó dùng công nghệ OCR để nhận dạng chữ/số có trong ảnh đó. */\ncy.visit(\&quot;https://practice.expandtesting.com/challenging-dom\&quot;);\ncy.get(\&quot;canvas\&quot;) // canvas cuối trang\n.should(\&quot;be.visible\&quot;).then($c =&gt; $c[0].toDataURL(\&quot;image/png\&quot;)).then(dataUrl =&gt; cy.task(\&quot;ocrFromBase64\&quot;, dataUrl)).then(text =&gt; {\n  const num = (text.match(/\\b\\d+\\b/) || [null])[0]; // lấy số đầu tiên\n  expect(num, \&quot;Answer number\&quot;).to.match(/^\\d+$/);\n  // Log kết quả\n  cy.log(`Answer: ${num}`);\n});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;CypressError: `cy.task(&#x27;ocrFromBase64&#x27;)` failed with the following error:\n\nThe &#x27;task&#x27; event has not been registered in the setupNodeEvents method. You must register it before using cy.task()\n\nFix this in your setupNodeEvents method here:\nD:\\Gr3\\cypress.config.js\n\nhttps://on.cypress.io/api/task&quot;,&quot;estack&quot;:&quot;CypressError: `cy.task(&#x27;ocrFromBase64&#x27;)` failed with the following error:\n\nThe &#x27;task&#x27; event has not been registered in the setupNodeEvents method. You must register it before using cy.task()\n\nFix this in your setupNodeEvents method here:\nD:\\Gr3\\cypress.config.js\n\nhttps://on.cypress.io/api/task\n    at &lt;unknown&gt; (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:138188:72)\n    at tryCatcher (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:1777:23)\n    at Promise._settlePromiseFromHandler (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:1489:31)\n    at Promise._settlePromise (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:1546:18)\n    at Promise._settlePromise0 (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:1591:10)\n    at Promise._settlePromises (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:1667:18)\n    at _drainQueueStep (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:2377:12)\n    at _drainQueue (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:2370:9)\n    at Async._drainQueues (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:2386:5)\n    at Async.drainQueues (https://practice.expandtesting.com/__cypress/runner/cypress_runner.js:2256:14)&quot;},&quot;uuid&quot;:&quot;2ba78774-0f63-4055-93e5-369d6bed0578&quot;,&quot;parentUUID&quot;:&quot;38acbb1c-6380-4c46-b3ea-a2c2e6d7b77d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Cách 2- Sử dụng onBeforeLoad on canvas&quot;,&quot;fullTitle&quot;:&quot;BT10 Cách 2- Sử dụng onBeforeLoad on canvas&quot;,&quot;duration&quot;:1840,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;/**onBeforeLoad chạy TRƯỚC khi JavaScript của trang web thực thi */\ncy.visit(\&quot;https://practice.expandtesting.com/challenging-dom\&quot;, {\n  onBeforeLoad(win) {\n    // lưu nơi chứa các text được vẽ lên canvas\n    win.__canvasTexts = []; //Tao tạo sẵn một cái hộp rỗng để lát nữa hứng chữ vẽ trên canvas\n    const proto = win.CanvasRenderingContext2D.prototype; //Lấy object prototype chung cho TẤT CẢ canvas 2D trên trang\n    /*CanvasRenderingContext2D làclass gốc của context 2D của &lt;canvas&gt;\n    Vì sao phải lấy prototype? =&gt;&gt;Để hook / override / spy các hàm canvas trước khi trang vẽ.\n     */\n    if (!(proto !== null &amp;&amp; proto !== void 0 &amp;&amp; proto.fillText)) return;\n    /*Nếu proto tồn tại =&gt;&gt; lấy proto.fillText\n    return: Nếu không có fillText để hook thì ko làm gì cả\n    */\n    const originalFillText = proto.fillText; // vẽ những gì hứng được ở trên (là lưu lại hàm vẽ chữ gốc của canvas để sau khi hook vẫn giữ nguyên hành vi vẽ.)\n    proto.fillText = function (text, ...rest) {\n      try {\n        win.__canvasTexts.push(String(text));\n      } catch (e) {\n        // ignore\n      }\n      return originalFillText.call(this, text, ...rest);\n    };\n  }\n});\n// Đợi canvas xuất hiện (trang này có canvas)\ncy.get(\&quot;canvas\&quot;, {\n  timeout: 10000\n}).should(\&quot;be.visible\&quot;);\n// Lấy chuỗi \&quot;Answer: ....\&quot; đã bị hook lại và tách số\ncy.window().its(\&quot;__canvasTexts\&quot;).should(\&quot;be.an\&quot;, \&quot;array\&quot;).then(texts =&gt; {\n  var _answerLine$match;\n  const answerLine = texts.find(t =&gt; /answer\\s*:/i.test(t));\n  expect(answerLine, \&quot;Found &#x27;Answer: ...&#x27; drawn on canvas\&quot;).to.be.a(\&quot;string\&quot;);\n  const number = (_answerLine$match = answerLine.match(/\\d+/)) === null || _answerLine$match === void 0 ? void 0 : _answerLine$match[0];\n  expect(number, \&quot;Extracted number\&quot;).to.match(/^\\d+$/);\n  // log ra kết quả để kiểm tra\n  cy.log(`Answer number: ${number}`);\n  // nếu muốn dùng lại về sau\n  cy.wrap(number).as(\&quot;answerNumber\&quot;);\n});\n// Ví dụ: dùng lại alias\ncy.get(\&quot;@answerNumber\&quot;).then(n =&gt; {\n  // assert demo (chỉ minh hoạ)\n  expect(String(n)).to.have.length.greaterThan(0);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;50cc0c25-3ab6-4a8a-9468-61f715f96c73&quot;,&quot;parentUUID&quot;:&quot;38acbb1c-6380-4c46-b3ea-a2c2e6d7b77d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Cách 3-Lấy data  by “hook + reload”&quot;,&quot;fullTitle&quot;:&quot;BT10 Cách 3-Lấy data  by “hook + reload”&quot;,&quot;duration&quot;:1426,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;/*  Hook canvas kiểu “spy” bằng cy.window(). Không sử dụng OCR\nCách này theo dõi hành vi vẽ canvas sau khi trang đã load, \nkhông can thiệp logic gốc */\n// Đặt thêm vào cypress/support/e2e.js: Cypress.on() =&gt;&gt;Đăng ký event listener toàn cục cho toàn bộ test\ncy.visit(\&quot;https://practice.expandtesting.com/challenging-dom\&quot;);\ncy.get(\&quot;canvas\&quot;).should(\&quot;be.visible\&quot;);\ncy.window().its(\&quot;__canvasTexts\&quot;).then(texts =&gt; {\n  var _line$match;\n  const line = texts.find(t =&gt; /answer\\s*:/i.test(t));\n  const number = line === null || line === void 0 || (_line$match = line.match(/\\d+/)) === null || _line$match === void 0 ? void 0 : _line$match[0];\n  expect(number).to.match(/^\\d+$/);\n  cy.log(`Answer number: ${number}`);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3b89825b-566c-4b7f-a9c5-14e172f35cb9&quot;,&quot;parentUUID&quot;:&quot;38acbb1c-6380-4c46-b3ea-a2c2e6d7b77d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;50cc0c25-3ab6-4a8a-9468-61f715f96c73&quot;,&quot;3b89825b-566c-4b7f-a9c5-14e172f35cb9&quot;],&quot;failures&quot;:[&quot;2ba78774-0f63-4055-93e5-369d6bed0578&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5102,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;7.2.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.4&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;cypress/reports&quot;,&quot;overwrite&quot;:false,&quot;html&quot;:true,&quot;json&quot;:true},&quot;version&quot;:&quot;6.3.2&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;cypress/reports&quot;,&quot;reportTitle&quot;:&quot;Gr3&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:false,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;cypress\\reports\\assets&quot;,&quot;jsonFile&quot;:&quot;D:\\Gr3\\cypress\\reports\\mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;D:\\Gr3\\cypress\\reports\\mochawesome.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>